name: d8bb11e5-61af-4213-8e1d-d6ab567bda6b
id: d8bb11e5-61af-4213-8e1d-d6ab567bda6b
category: Office
version: 0.0.1.3
inputs:
- name: train_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: valid_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: gmr_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: vocab_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: rsp_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: pretrained_model_path
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: model_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: eval_input_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: SubscriptionId
  optional: true
  type: String
  default: 98d476c6-c75b-481c-8c18-f53d91f614b0
- name: ResourceGroupName
  optional: true
  type: String
  default: Phase2Prod
- name: WorkspaceName
  optional: true
  type: String
  default: Matrix
- name: Region
  optional: true
  type: String
  default: southcentralus
- name: AmlExperimentName
  optional: true
  type: String
  default: SmartReply_TNLR
- name: Framework
  optional: true
  type: String
  default: Python
- name: Target
  optional: true
  type: String
  default: Generaldedicated
- name: BaseDockerImage
  optional: true
  type: String
  default: mcr.microsoft.com/azureml/bert:pretrain-openmpi3.1.2-cuda10.0-cudnn7-ubuntu16.04
- name: GpuSupport
  optional: true
  type: String
  default: 'true'
- name: UserManagedDependencies
  optional: true
  type: String
  default: 'true'
- name: CreateDataStoreIfNotExist
  optional: true
  type: String
  default: 'true'
- name: NodeCount
  optional: true
  type: Int
  default: '1'
- name: Communicator
  optional: true
  type: String
  default: mpi
- name: MpiProcessCountPerNode
  optional: true
  type: Int
  default: '4'
- name: Script
  optional: true
  type: String
  default: smartreply/models/matching/driver.py
- name: interpreterPath
  optional: true
  type: String
  default: /opt/miniconda/envs/amlbert/bin/python
- name: architecture
  optional: true
  type: String
  default: bert_matching_model
- name: pretrained_model_file
  optional: true
  type: String
  default: bert_encoder_epoch_500.pt
- name: run_mode
  optional: true
  type: String
  default: train
- name: load_from
  optional: true
  type: String
  default: tnlr
- name: max_epochs
  optional: true
  type: Int
  default: '5'
- name: lm_alpha
  optional: true
  type: String
  default: '1.4'
- name: batch_size
  optional: true
  type: Int
  default: '256'
- name: batch_size_infer
  optional: true
  type: Int
  default: '256'
- name: learning_rate
  optional: true
  type: String
  default: '3e-4'
- name: max_msg_len
  optional: true
  type: Int
  default: '64'
- name: max_rsp_len
  optional: true
  type: Int
  default: '64'
- name: decay_step
  optional: true
  type: Int
  default: '2000'
- name: decay_rate
  optional: true
  type: String
  default: '0.99'
- name: warmup_proportion
  optional: true
  type: String
  default: '0.0002'
- name: loss_scale
  optional: true
  type: Int
  default: '0'
- name: tokenizer
  optional: true
  type: String
  default: wordpiece
- name: gradient_accumulation_steps
  optional: true
  type: Int
  default: '1'
- name: optimizer
  optional: true
  type: String
  default: adam
- name: validation_freq
  optional: true
  type: Int
  default: '-1'
- name: save_freq
  optional: true
  type: Int
  default: '-1'
- name: manual_seed
  optional: true
  type: Int
  default: '42'
- name: infer_batches
  optional: true
  type: Int
  default: '1000'
- name: Arguments
  optional: true
  type: String
outputs:
- name: model_output_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
- name: eval_output_dir
  type:
  - AzureEncryptedBlobReference
  description: AzureEncryptedBlobReference
  port: true
  optional: true
implementation:
  container:
    runConfig:
      baseDockerImage: mcr.microsoft.com/azureml/base:intelmpi2018.3-ubuntu16.04
      gpuSupport: false
    conda:
      name: project_environment
      channels:
      - defaults
      dependencies:
      - python=3.6.8
      - pip:
        - azureml-designer-classic-modules==0.0.110
    entry: mock_entry.py
    args:
    - --input-0
    - inputPath: train_input_dir
    - --input-1
    - inputPath: valid_input_dir
    - --input-2
    - inputPath: gmr_input_dir
    - --input-3
    - inputPath: vocab_input_dir
    - --input-4
    - inputPath: rsp_input_dir
    - --input-5
    - inputPath: pretrained_model_path
    - --input-6
    - inputPath: model_input_dir
    - --input-7
    - inputPath: eval_input_dir
    - --output-0
    - outputPath: model_output_dir
    - --output-1
    - outputPath: eval_output_dir
    - --param-0
    - inputValue: SubscriptionId
    - --param-1
    - inputValue: ResourceGroupName
    - --param-2
    - inputValue: WorkspaceName
    - --param-3
    - inputValue: Region
    - --param-4
    - inputValue: AmlExperimentName
    - --param-5
    - inputValue: Framework
    - --param-6
    - inputValue: Target
    - --param-7
    - inputValue: BaseDockerImage
    - --param-8
    - inputValue: GpuSupport
    - --param-9
    - inputValue: UserManagedDependencies
    - --param-10
    - inputValue: CreateDataStoreIfNotExist
    - --param-11
    - inputValue: NodeCount
    - --param-12
    - inputValue: Communicator
    - --param-13
    - inputValue: MpiProcessCountPerNode
    - --param-14
    - inputValue: Script
    - --param-15
    - inputValue: interpreterPath
    - --param-16
    - inputValue: architecture
    - --param-17
    - inputValue: pretrained_model_file
    - --param-18
    - inputValue: run_mode
    - --param-19
    - inputValue: load_from
    - --param-20
    - inputValue: max_epochs
    - --param-21
    - inputValue: lm_alpha
    - --param-22
    - inputValue: batch_size
    - --param-23
    - inputValue: batch_size_infer
    - --param-24
    - inputValue: learning_rate
    - --param-25
    - inputValue: max_msg_len
    - --param-26
    - inputValue: max_rsp_len
    - --param-27
    - inputValue: decay_step
    - --param-28
    - inputValue: decay_rate
    - --param-29
    - inputValue: warmup_proportion
    - --param-30
    - inputValue: loss_scale
    - --param-31
    - inputValue: tokenizer
    - --param-32
    - inputValue: gradient_accumulation_steps
    - --param-33
    - inputValue: optimizer
    - --param-34
    - inputValue: validation_freq
    - --param-35
    - inputValue: save_freq
    - --param-36
    - inputValue: manual_seed
    - --param-37
    - inputValue: infer_batches
    - --param-38
    - inputValue: Arguments
